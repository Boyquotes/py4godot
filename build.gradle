task build_python (type:Exec) {
    commandLine "cmd","/c","python setup.py build_ext --compiler=msvc"
}

task createAddons(type: Copy) {
    from('build/lib.win-amd64-3.9')
    into('build/addons')
}

task copyBuild(type:Copy){
    from('build/lib.win-amd64-3.9')
    into('buildTemp/lib')
}

task deleteBuild(type:Delete){
    delete "build/lib.win-amd64-3.9"
}

task copyTemp(type:Copy){
    from('build/temp.win-amd64-3.9')
    into('buildTemp/temp')
}

task deleteTemp(type:Delete){
    delete "build/temp.win-amd64-3.9"
}

task copyBeforeBuild_Build(type:Copy){
    from('buildTemp/lib')
    into('build/lib.win-amd64-3.9')
}

task copyBeforeBuild_Temp(type:Copy){
    from('buildTemp/temp')
    into('build/temp.win-amd64-3.9')
}

build_python.configure{dependsOn copyBeforeBuild_Build, copyBeforeBuild_Temp}
build_python.configure { finalizedBy createAddons }
createAddons.configure{finalizedBy copyBuild, copyTemp}
copyTemp.configure{finalizedBy deleteTemp}
copyBuild.configure{finalizedBy deleteBuild}
task build (type:Exec) {
    commandLine "cmd","/c","python setup.py build_ext --compiler=msvc"
}

task createAddons(type: Copy) {
    from('build/lib.win-amd64-3.9')
    into('build/addons')
    include('*')
}

task copyBuild(type:Copy){
    from('build/lib.win-amd64-3.9')
    into('buildTemp/lib')
    include('*')
}

task deleteBuild(type:Delete){
    delete "build/lib.win-amd64-3.9"
}

task copyTemp(type:Copy){
    from('build/temp.win-amd64-3.9')
    into('buildTemp/temp')
    include('*')
}

task deleteTemp(type:Delete){
    delete "build/temp.win-amd64-3.9"
}

build.configure { finalizedBy createAddons }
createAddons.configure{finalizedBy copyBuild}
copyBuild.configure{finalizedBy copyTemp}
copyTemp.configure{finalizedBy deleteTemp}
copyBuild.configure{finalizedBy deleteBuild}